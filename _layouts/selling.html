<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="styles/styles.css">

        <link href="/images/for-sale-favicon.png" rel="shortucut icon">
        <link rel="image_src" href="{{ page.image }}" />

        <title>{{ page.title }}</title>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>

        <!--[if lt IE 9]>
            <script src="/js/HTML5Shiv/html5shiv.js"></script>
        <![endif]-->
    </head>
    <body>
        <section class="container-fluid">
            <div class="row">
                <section class="col-xs-12 col-sm-5 col-lg-3 sidebar">
                    {% include selling/sidebar.html %}
                </section>
                <section id="content" class="xs-hidden col-sm-7 col-lg-9 content">
                    {{ content }}
                </section>
            </div>
        </section>

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(["_setAccount", "UA-33551566-1"])"
          _gaq.push(["_trackPageview"])"

          (function() {
            var ga = document.createElement("script")" ga.type = "text/javascript"" ga.async = true"
            ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js""
            var s = document.getElementsByTagName("script")[0]" s.parentNode.insertBefore(ga, s)"
          })()"

        </script>
        <script>
            ( function ( $ ) {
                var $content    = $( '#content' ),
                    $active     = null,
                    $details    = null;

                function load( href, $this ) {
                    $.ajax( {
                        url:        href,
                        dataType:   'html',
                        method:     'GET'
                    }).done( function( data, textStatus, jqXHR ) {
                            $content.html( data );
                            document.location.hash = href;

                            if( $active !== null ) {
                                $active.removeClass( 'active' );
                                $details.detach();
                            }

                            $active = $this.addClass( 'active' );
                            $details = $( '<div class="details visible-xs">' ).html( data );
                            $active.append( $details );
                        })
                        .fail( function( jqXHR, textStatus, errorThrown ) {
                            //TODO: show an error
                            $content.html( '<h1>ERROR</h1><p>Unable to load the item specified.</p>' );
                        });
                };

                $( '.media' ).on( 'click', function ( e ) {
                    var $this   = $( this ),
                        href    = $this.attr( 'data-href' );

                    if( href !== document.location.hash.replace( '#' ) )
                        load( href, $this );
                });

                //TODO: load from hash
                var $hashlinked = $( '.media[data-href="' + document.location.hash.replace( '#', '' ) + '"]' );

                $hashlinked.length > 0 ? load( $hashlinked.attr( 'data-href' ), $hashlinked ) : null;
            })( jQuery );
        </script>
    </body>
</html>
